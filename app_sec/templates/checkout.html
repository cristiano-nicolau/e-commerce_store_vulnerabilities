<!-- /*
* Bootstrap 5
* Template Name: Furni
* Template Author: Untree.co
* Template URI: https://untree.co/
* License: https://creativecommons.org/licenses/by/3.0/
*/ -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="Untree.co">
  <link rel="shortcut icon" href="../images/favicon.png">

  <meta name="description" content="" />
  <meta name="keywords" content="bootstrap, bootstrap4" />

		<!-- Bootstrap CSS -->
		<link href="../css/bootstrap.min.css" rel="stylesheet">
		<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
		<link href="../css/tiny-slider.css" rel="stylesheet">
		<link href="../css/style.css" rel="stylesheet">
		<title>DETI - Departamento de Electrónica, Telecomunicações e Informática </title>
	</head>

	<body>

		<!-- Start Header/Navigation -->
		<nav class="custom-navbar navbar navbar-expand-md navbar-dark bg-dark" arial-label="Furni navigation bar">
			<div class="container">
				<a class="navbar-brand" href="index.html">DETI Store<span>.</span></a>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsFurni" aria-controls="navbarsFurni" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
		
				<div class="collapse navbar-collapse" id="navbarsFurni">
					<ul class="custom-navbar-nav navbar-nav ms-auto mb-2 mb-md-0">
						<li class="nav-item">
							<a class="nav-link" href="index.html">Home</a>
						</li>
						<li><a class="nav-link" href="shop.html">Shop</a></li>
						<li><a class="nav-link" href="about.html">About us</a></li>
					</ul>
		
					<ul class="custom-navbar-cta navbar-nav mb-2 mb-md-0 ms-5">
						<li id="Admin" class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
								<img src="../images/user_copy.svg">
							</a>
							<ul class="dropdown-menu" aria-labelledby="userDropdown">
								<li><a class="dropdown-item" href="userdashboard.html">Account Details</a></li>
								<li><hr class="dropdown-divider"></li>
								<li id="logout"><a class="dropdown-item text-danger" >Logout</a></li>
							</ul>
						</li>
						<li id="User" class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
								<img src="../images/user_copy.svg">
							</a>
							<ul class="dropdown-menu" aria-labelledby="userDropdown">
								<li><a class="dropdown-item" href="userdashboard.html">Account Details</a></li>
								<li><a class="dropdown-item" href="orders.html">Orders</a></li>
								<li><hr class="dropdown-divider"></li>
								<li id="logout-id"><a class="dropdown-item text-danger" >Logout</a></li>
							</ul>
						</li>
						<li id="NotAuthenticated"><a class="nav-link" href="reg_log.html"><img src="../images/user.svg"></a></li>
						<li id="Cart"><a class="nav-link" href="cart.html"><img src="../images/cart.svg"></a></li>
					</ul>
				</div>
			</div>
		</nav>
		<!-- End Header/Navigation -->

		<!-- Start Hero Section -->
			<div class="hero">
				<div class="container">
					<div class="row justify-content-between">
						<div class="col-lg-5">
							<div class="intro-excerpt">
								<h1>Checkout</h1>
							</div>
						</div>
						<div class="col-lg-7">
							
						</div>
					</div>
				</div>
			</div>
		<!-- End Hero Section -->

		<div class="untree_co-section">
		    <div class="container">
		      <div class="row mb-5">
		        <div class="col-md-12">
					<div class="border p-4 rounded" role="alert">
						<a href="index.html">Click here</a>to return home.
										  </div>
		        </div>
		      </div>
		      <div class="row">
				<div class="col-md-6 mb-5 mb-md-0">
				<h2 class="h3 mb-3 text-black">Billing Details</h2>
				<div class="p-3 p-lg-5 border bg-white">
				<div class="form-group">
				<label class="text-black" for="autocomplete_country">Country <span class="text-danger">*</span></label>
				<input class="form-control" id="autocomplete_country" type="text"/>
				</div>
				<div class="form-group row">
				<div class="col-md-6">
				<label class="text-black" for="c_fname">First Name <span class="text-danger">*</span></label>
				<input class="form-control" id="c_fname" name="c_fname" type="text"/>
				</div>
				<div class="col-md-6">
				<label class="text-black" for="c_lname">Last Name <span class="text-danger">*</span></label>
				<input class="form-control" id="c_lname" name="c_lname" type="text"/>
				</div>
				</div>
				<div class="form-group row">
				<div class="col-md-12">
				</div>
				</div>
				<div class="form-group row">
				<div class="col-md-12">
				<label class="text-black" for="c_address">Address <span class="text-danger">*</span></label>
				<input class="form-control" id="c_address" name="c_address" placeholder="Street address" type="text"/>
				</div>
				</div>
				<div class="form-group mt-3">
				<input class="form-control" placeholder="Apartment, suite, unit etc. (optional)" type="text"/>
				</div>
				<div class="form-group row">
				<div class="col-md-6">
				<label class="text-black" for="c_state_country">State / Country <span class="text-danger">*</span></label>
				<input class="form-control" id="c_state_country" name="c_state_country" type="text"/>
				</div>
				<div class="col-md-6">
				<label class="text-black" for="c_postal_zip">Posta / Zip <span class="text-danger">*</span></label>
				<input class="form-control" id="c_postal_zip" name="c_postal_zip" type="text"/>
				</div>
				</div>
				<div class="form-group row mb-5">
				<div class="col-md-6">
				<label class="text-black" for="c_email_address">Email Address <span class="text-danger">*</span></label>
				<input class="form-control" id="c_email_address" name="c_email_address" type="text"/>
				</div>
				<div class="col-md-6">
				<label class="text-black" for="c_phone">Phone <span class="text-danger">*</span></label>
				<input class="form-control" id="c_phone" name="c_phone" placeholder="Phone Number" type="text"/>
				</div>
				</div>
				<div class="form-group">
				<div class="collapse" id="ship_different_address">
				<div class="py-2">
				<div class="form-group">
				<label class="text-black" for="c_diff_country">Country <span class="text-danger">*</span></label>
				<select class="form-control" id="c_diff_country">
				<option value="1">Select a country</option>
				<option value="2">bangladesh</option>
				<option value="3">Algeria</option>
				<option value="4">Afghanistan</option>
				<option value="5">Ghana</option>
				<option value="6">Albania</option>
				<option value="7">Bahrain</option>
				<option value="8">Colombia</option>
				<option value="9">Dominican Republic</option>
				</select>
				</div>
				<div class="form-group row">
				<div class="col-md-6">
				<label class="text-black" for="c_diff_fname">First Name <span class="text-danger">*</span></label>
				<input class="form-control" id="c_diff_fname" name="c_diff_fname" type="text"/>
				</div>
				<div class="col-md-6">
				<label class="text-black" for="c_diff_lname">Last Name <span class="text-danger">*</span></label>
				<input class="form-control" id="c_diff_lname" name="c_diff_lname" type="text"/>
				</div>
				</div>
				<div class="form-group row">
				<div class="col-md-12">
				<label class="text-black" for="c_diff_companyname">Company Name </label>
				<input class="form-control" id="c_diff_companyname" name="c_diff_companyname" type="text"/>
				</div>
				</div>
				<div class="form-group row mb-3">
				<div class="col-md-12">
				<label class="text-black" for="c_diff_address">Address <span class="text-danger">*</span></label>
				<input class="form-control" id="c_diff_address" name="c_diff_address" placeholder="Street address" type="text"/>
				</div>
				</div>
				<div class="form-group">
				<input class="form-control" placeholder="Apartment, suite, unit etc. (optional)" type="text"/>
				</div>
				<div class="form-group row">
				<div class="col-md-6">
				<label class="text-black" for="c_diff_state_country">State / Country <span class="text-danger">*</span></label>
				<input class="form-control" id="c_diff_state_country" name="c_diff_state_country" type="text"/>
				</div>
				<div class="col-md-6">
				<label class="text-black" for="c_diff_postal_zip">Posta / Zip <span class="text-danger">*</span></label>
				<input class="form-control" id="c_diff_postal_zip" name="c_diff_postal_zip" type="text"/>
				</div>
				</div>
				<div class="form-group row mb-5">
				<div class="col-md-6">
				<label class="text-black" for="c_diff_email_address">Email Address <span class="text-danger">*</span></label>
				<input class="form-control" id="c_diff_email_address" name="c_diff_email_address" type="text"/>
				</div>
				<div class="col-md-6">
				<label class="text-black" for="c_diff_phone">Phone <span class="text-danger">*</span></label>
				<input class="form-control" id="c_diff_phone" name="c_diff_phone" placeholder="Phone Number" type="text"/>
				</div>
				</div>
				</div>
				</div>
				</div>
				<div class="form-group">
				</div>
				</div>
				</div>
				<div class="col-md-6">
				<div class="row mb-5">
				<div class="col-md-12">
				<h2 class="h3 mb-3 text-black">Your Order</h2>
				<div class="p-3 p-lg-5 border bg-white">
					<table class="table site-block-order-table mb-5">
						<thead>
							<th>Product</th>
							<th>Total</th>
						</thead>
						<tbody id="checkout-items">
							<!-- JavaScript will dynamically insert rows here -->
						</tbody>
						<tfoot>
							<tr>
								<td class="text-black font-weight-bold"><strong>Cart Subtotal</strong></td>
								<td class="text-black" id="checkoutTotal"></td>
							</tr>
							<tr>
								<td class="text-black font-weight-bold"><strong>Order Total</strong></td>
								<td class="text-black font-weight-bold" id="orderTotal"><strong></strong></td>
							</tr>
						</tfoot>
					</table>
				<div class="form-group">
					<button class="btn btn-black btn-lg py-3 btn-block" onclick="placeOrder()">Place Order</button>
				</div>
				</div>
				</div>
				</div>
				</div>
				</div>
		      <!-- </form> -->
		    </div>
		  </div>

		<!-- Start Footer Section -->
		<footer class="footer-section">
			<div class="container relative">


				<div class="row g-5 mb-5">
					<div class="col-lg-4">
						<div class="mb-4 footer-logo-wrap"><a href="#" class="footer-logo">DETI Store<span>.</span></a></div>
						<p class="mb-4">DETI, or the Department of Electronics, Telecommunications, and Informatics, is a pioneering academic department at our university. Known for its commitment to excellence, DETI offers cutting-edge programs, research opportunities, and a vibrant community where innovation thrives.</p>

						<ul class="list-unstyled custom-social">
							<li><a href="#"><span class="fa fa-brands fa-facebook-f"></span></a></li>
							<li><a href="#"><span class="fa fa-brands fa-twitter"></span></a></li>
							<li><a href="#"><span class="fa fa-brands fa-instagram"></span></a></li>
							<li><a href="#"><span class="fa fa-brands fa-linkedin"></span></a></li>
						</ul>
					</div>

					<div class="col-lg-8">
						<div class="row links-wrap">
							<div class="col-6 col-sm-6 col-md-3">
								<ul class="list-unstyled">
									<li><a href="#">About us</a></li>
									<li><a href="#">Services</a></li>
									<li><a href="/templates/reviews.html">Reviews</a></li>
									<li><a href="#">Contact us</a></li>
								</ul>
							</div>

							<div class="col-6 col-sm-6 col-md-3">
								<ul class="list-unstyled">
									<li><a href="#">Support</a></li>
									<li><a href="#">Knowledge base</a></li>
									<li><a href="#">Live chat</a></li>
								</ul>
							</div>

							<div class="col-6 col-sm-6 col-md-3">
								<ul class="list-unstyled">
									<li><a href="#">Jobs</a></li>
									<li><a href="#">Our team</a></li>
									<li><a href="#">Leadership</a></li>
									<li><a href="#">Privacy Policy</a></li>
								</ul>
							</div>

							
						</div>
					</div>

				</div>

				<div class="border-top copyright">
					<div class="row pt-4">
						<div class="col-lg-6">
							<p class="mb-2 text-center text-lg-start">Copyright &copy;<script>document.write(new Date().getFullYear());</script>. All Rights Reserved. &mdash; Designed with love by <a href="https://untree.co">Untree.co</a> Distributed By <a hreff="https://themewagon.com">ThemeWagon</a>  <!-- License information: https://untree.co/license/ -->
            </p>
						</div>

						<div class="col-lg-6 text-center text-lg-end">
							<ul class="list-unstyled d-inline-flex ms-auto">
								<li class="me-4"><a href="#">Terms &amp; Conditions</a></li>
								<li><a href="#">Privacy Policy</a></li>
							</ul>
						</div>

					</div>
				</div>

			</div>
		</footer>
		<!-- End Footer Section -->	

		<script>
			const logoutButton = document.getElementById("logout-id");
			logoutButton.addEventListener("click", function() {
        	fetch('http://127.0.0.1:5000/logout',{
				method: 'POST',
				headers: {
					'Authorization': localStorage.getItem('token')
				}
			})
				.then(response => response.json())
				.then(data => {
					if (data.success) {

						window.location.href = "index.html";
					}
				})
				.catch(error => {
					console.error('Error:', error);
				});

				localStorage.removeItem('token');
				localStorage.removeItem('user_id');

				window.location.href = "index.html";})
					 function checkToken() {
			const token = localStorage.getItem('token'); // Verifique o token armazenado no localStorage
			var Admin = document.getElementById('Admin');
            var User = document.getElementById('User');
            var NotAuthenticated = document.getElementById('NotAuthenticated');
			if (token) {
				fetch('http://127.0.0.1:5000/user_info', {
					method: 'GET',
					headers: {
					'Authorization': token 
					}
				})
				.then(response => response.json())
				.then(data => {
				// Verifique se o usuário está autenticado e recupere o tipo de usuário
				if (data.is_authenticated) {
					if (data.user_type === 'admin') {
						Admin.style.display = 'block';
						User.style.display = 'none';
						NotAuthenticated.style.display = 'none';
					} else {
						Admin.style.display = 'none';
						User.style.display = 'block';
						NotAuthenticated.style.display = 'none';
					}
				} else {
					Admin.style.display = 'none';
					User.style.display = 'none';
					NotAuthenticated.style.display = 'block';
				}
				})
				.catch(error => {
				console.error('Erro ao buscar informações do usuário:', error);
				});
			} else {
				Admin.style.display = 'none';
                User.style.display = 'none';
                NotAuthenticated.style.display = 'block';
			}
		}
		checkToken();
		</script>
		<script>



			function fetchCheckoutItems() {
				const userId = localStorage.getItem('user_id');
				const checkoutItemsDiv = document.getElementById('checkout-items');
				const checkoutTotalDiv = document.getElementById('checkoutTotal');
				const orderTotalDiv = document.getElementById('orderTotal');
			
				checkoutItemsDiv.innerHTML = '';
			
				fetch(`http://127.0.0.1:5000/cart/${userId}`, { method: 'GET' })
					.then(response => response.json())
					.then(data => {
						const cartItems = data.products;
			
						if (cartItems.length === 0) {
							checkoutItemsDiv.innerHTML = '<tr><td colspan="2">Your cart is empty.</td></tr>';
							checkoutTotalDiv.innerHTML = '<strong class="text-black">$0.00</strong>';
							orderTotalDiv.innerHTML = '<strong class="text-black">$0.00</strong>';
						} else {
							let totalValue = 0;
			
							cartItems.forEach(item => {
								const row = document.createElement('tr');
								row.innerHTML = `
									<td class="product-name">${item.name}</td>
									<td class="product-price">${item.price}</td>
								`;
								checkoutItemsDiv.appendChild(row);
								totalValue += parseFloat(item.price);
							});
			
							const formattedTotal = `<strong class="text-black">${totalValue}</strong>`;
							checkoutTotalDiv.innerHTML = formattedTotal;
							orderTotalDiv.innerHTML = formattedTotal;
						}
					})
					.catch(error => console.error('Error:', error));
			}
			
			fetchCheckoutItems();
			
			
			</script>		
			<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
			<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
			<script>
						// List of countries (source: ISO 3166-1 alpha-2 country codes)
						const countries = [
						"Select a country",
						"Afghanistan",
						"Albania",
						"Algeria",
						"Andorra",
						"Angola",
						"Antigua & Deps",
						"Argentina",
						"Armenia",
						"Australia",
						"Austria",
						"Azerbaijan",
						"Bahamas",
						"Bahrain",
						"Bangladesh",
						"Barbados",
						"Belarus",
						"Belgium",
						"Belize",
						"Benin",
						"Bhutan",
						"Bolivia",
						"Bosnia Herzegovina",
						"Botswana",
						"Brazil",
						"Brunei",
						"Bulgaria",
						"Burkina",
						"Burundi",
						"Cambodia",
						"Cameroon",
						"Canada",
						"Cape Verde",
						"Central African Rep",
						"Chad",
						"Chile",
						"China",
						"Colombia",
						"Comoros",
						"Congo",
						"Congo {Democratic Rep}",
						"Costa Rica",
						"Croatia",
						"Cuba",
						"Cyprus",
						"Czech Republic",
						"Denmark",
						"Djibouti",
						"Dominica",
						"Dominican Republic",
						"East Timor",
						"Ecuador",
						"Egypt",
						"El Salvador",
						"Equatorial Guinea",
						"Eritrea",
						"Estonia",
						"Ethiopia",
						"Fiji",
						"Finland",
						"France",
						"Gabon",
						"Gambia",
						"Georgia",
						"Germany",
						"Ghana",
						"Greece",
						"Grenada",
						"Guatemala",
						"Guinea",
						"Guinea-Bissau",
						"Guyana",
						"Haiti",
						"Honduras",
						"Hungary",
						"Iceland",
						"India",
						"Indonesia",
						"Iran",
						"Iraq",
						"Ireland {Republic}",
						"Israel",
						"Italy",
						"Ivory Coast",
						"Jamaica",
						"Japan",
						"Jordan",
						"Kazakhstan",
						"Kenya",
						"Kiribati",
						"Korea North",
						"Korea South",
						"Kosovo",
						"Kuwait",
						"Kyrgyzstan",
						"Laos",
						"Latvia",
						"Lebanon",
						"Lesotho",
						"Liberia",
						"Libya",
						"Liechtenstein",
						"Lithuania",
						"Luxembourg",
						"Macedonia",
						"Madagascar",
						"Malawi",
						"Malaysia",
						"Maldives",
						"Mali",
						"Malta",
						"Marshall Islands",
						"Mauritania",
						"Mauritius",
						"Mexico",
						"Micronesia",
						"Moldova",
						"Monaco",
						"Mongolia",
						"Montenegro",
						"Morocco",
						"Mozambique",
						"Myanmar, {Burma}",
						"Namibia",
						"Nauru",
						"Nepal",
						"Netherlands",
						"New Zealand",
						"Nicaragua",
						"Niger",
						"Nigeria",
						"Norway",
						"Oman",
						"Pakistan",
						"Palau",
						"Panama",
						"Papua New Guinea",
						"Paraguay",
						"Peru",
						"Philippines",
						"Poland",
						"Portugal",
						"Qatar",
						"Romania",
						"Russian Federation",
						"Rwanda",
						"St Kitts & Nevis",
						"St Lucia",
						"Saint Vincent & the Grenadines",
						"Samoa",
						"San Marino",
						"Sao Tome & Principe",
						"Saudi Arabia",
						"Senegal",
						"Serbia",
						"Seychelles",
						"Sierra Leone",
						"Singapore",
						"Slovakia",
						"Slovenia",
						"Solomon Islands",
						"Somalia",
						"South Africa",
						"South Sudan",
						"Spain",
						"Sri Lanka",
						"Sudan",
						"Suriname",
						"Swaziland",
						"Sweden",
						"Switzerland",
						"Syria",
						"Taiwan",
						"Tajikistan",
						"Tanzania",
						"Thailand",
						"Togo",
						"Tonga",
						"Trinidad & Tobago",
						"Tunisia",
						"Turkey",
						"Turkmenistan",
						"Tuvalu",
						"Uganda",
						"Ukraine",
						"United Arab Emirates",
						"United Kingdom",
						"United States",
						"Uruguay",
						"Uzbekistan",
						"Vanuatu",
						"Vatican City",
						"Venezuela",
						"Vietnam",
						"Yemen",
						"Zambia",
						"Zimbabwe"
					];
					
					
						$(function () {
							$("#autocomplete_country").autocomplete({
								source: countries
							});
						});
					</script>
		<script>
			function isEmpty(str) {
				return !str.trim().length;
			}
		
			function validateForm() {
				// List of required input fields' IDs
				var requiredFields = [
					"c_diff_fname",
					"c_diff_lname",
					"c_diff_address",
					"c_diff_state_country",
					"c_diff_postal_zip",
					"c_diff_email_address",
					"c_diff_phone"
				];
		
				// Loop through each required field
				for (var i = 0; i < requiredFields.length; i++) {
					var field = document.getElementById(requiredFields[i]);
		
					// Check if the field is empty using the isEmpty function
					if (isEmpty(field.value)) {
						alert("Please fill in all required fields.");
						return false;
					}
				}
				return true;
			}
		
			// JavaScript: Function to place an order
			function placeOrder() {
			const userId = localStorage.getItem('user_id');
		
			// Fetch cart items to place the order
			fetch(`http://127.0.0.1:5000/cart/${userId}`, { method: 'GET' })
				.then(response => response.json())
				.then(data => {
					const cartItems = data.products;
		
					if (cartItems.length === 0) {
						console.error('Cart is empty. No order placed.');
					} else {
						// Place the order
						const orderData = {
							user_id: userId,
							order_status: 'pending',
							order_items: cartItems.map(item => ({
								product_id: item.id,
								quantity: 1, // Assuming 1 quantity for simplicity
								unit_price: parseFloat(item.price)
							}))
						};
		
						fetch('http://127.0.0.1:5000/orders', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							},
							body: JSON.stringify(orderData)
						})
						.then(response => response.json())
						.then(order => {
							// Redirect to the "thankyou.html" page after successful order placement
							window.location.href = 'thankyou.html';
						})
						.catch(error => console.error('Error placing order:', error));
					}
				})
				.catch(error => console.error('Error fetching cart items:', error));
		}
		
		
		
		// JavaScript: Function to fetch and display order details
			function fetchOrderDetails(orderId) {
				const ordersListDiv = document.getElementById('orders-list');
		
				fetch(`http://127.0.0.1:5000/orders/${orderId}`, { method: 'GET' })
					.then(response => response.json())
					.then(data => {
						const orderItems = data.order_items;
		
						orderItems.forEach(item => {
							const row = document.createElement('tr');
							row.innerHTML = `
								<td class="product-thumbnail"><img src="${item.photo}" alt="${item.name}"></td>
								<td class="product-name">${item.name}</td>
								<td class="product-quantity">${item.quantity}</td>
								<td class="product-price">${item.unit_price}</td>
							`;
							ordersListDiv.appendChild(row);
						});
					})
					.catch(error => console.error('Error fetching order details:', error));
			}
		
		</script>
		<script src="../js/bootstrap.bundle.min.js"></script>
		<script src="../js/tiny-slider.js"></script>
		<script src="../js/custom.js"></script>
	</body>

</html>
